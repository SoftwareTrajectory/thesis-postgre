require(ggplot2)
require(Cairo)
require(reshape)
require(scales)
require(RColorBrewer)
require(grid)
library(gridExtra)
#
znorm <- function(ts){
  ts.mean <- mean(ts)
  ts.dev <- sd(ts)
  (ts - ts.mean)/ts.dev
}
#
#
#pattern="iihecccccccc"; weight=0.1063
#0: [97, 98], [-0.6478854, -0.64199155, -0.63818632, -0.63825875, -0.63834515, -0.63869741, -0.64304876, -0.64376789, -0.64504991, -0.64711823, -0.64915334, -0.65124584, -0.65729046, -0.66220082, -0.66123227, -0.66098661, -0.66156196, -0.66225552, -0.66191228, -0.66274039, -0.66093438, -0.66344985, -0.66219448, -0.6623359, -0.66171176, -0.66139185, -0.66140829, -0.66144719, -0.66037322, -0.65910828, -0.65974177, -0.65817648, -0.65839527, -0.65734763, -0.65851971, -0.6584864, -0.657366, -0.65435815, -0.65251819, -0.6513159, -0.64814481, -0.64733294, -0.64709792, -0.64486153, -0.64360412, -0.64349171, -0.64265061, -0.6420974, -0.64447929, -0.6488921, -0.65765851, -0.66120325, -0.64966432, -0.61016844, -0.53743483, -0.46503123, -0.35853483, -0.28313648, -0.17744604, 0.15824648, 0.35028455, 0.48241039, 0.60380734, 0.79710411, 0.98755132, 1.2037853, 1.4065415, 1.5962459, 1.7128307, 1.7788152, 1.7938492, 1.7971408, 1.8101928, 1.8206277, 1.8172235, 1.8316333, 1.8316333, 1.828965, 1.8453761, 1.8452577, 1.8458113, 1.8424932, 1.8353569, 1.8363734, 1.8406975, 1.8325128, 1.8317604, 1.8292355, 1.82239, 1.8137368, 1.8065749, 1.7817465, 1.7681708, 1.714996, 1.6361695, 1.5421009, 1.4168285, 1.295362, 1.1717134, 1.0294766, 0.83269526, 0.74873661, 0.48444394, 0.46799664, 0.13619262, -0.02096398, -0.24144559, -0.42927857, -0.54787937, -0.65770118, -0.74082076, -0.77535158, -0.78246083, -0.7692917, -0.74327798, -0.71938126, -0.69687714, -0.6863145, -0.67373867, -0.6683903, -0.66464289, -0.66411665, -0.66429579, -0.66119756, -0.65934631, -0.65258234, -0.64332472, -0.63886892, -0.63655838, -0.63317355, -0.63303697, -0.63300935, -0.63303406, -0.63521866, -0.63446965, -0.63579121, -0.63628253, -0.63539522, -0.63607448, -0.63755154, -0.63926427, -0.63971561, -0.63973452, -0.64018371, -0.6392345, -0.63939473, -0.64023111, -0.64042873, -0.63866571, -0.63865722]
#[2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]

plot_series=function(x,y,weight,title){
  dat=data.frame(x=x,y=as.vector(unlist(y)),col=rescale(weight))
  p <- ggplot(dat, aes(x,y,colour=col)) + geom_line(size=1.2) +
    ggtitle(title) + theme_bw() + ylab("Added LOC") + xlab("Days")+
    #scale_y_continuous(expand=c(0.01,0.01),breaks=seq(-1,1,1),labels=paste(seq(-1,1,1))) + 
    scale_colour_gradientn(name = "Class specificity:  ",limits=c(0,1),
                           colours=c("darkgreen","chartreuse4","darkgoldenrod1","brown3","darkred"),
                           breaks=c(0,0.5,1),labels=c("low","neutral","high"), 
                           guide = guide_colorbar(title.theme=element_text(size=14, angle=0),title.vjust=1,
                                                  barheight=0.6, barwidth=6, label.theme=element_text(size=10, angle=0))) +
    theme(legend.position="bottom",plot.title=element_text(size=24),
          axis.title.x=element_blank(), 
          #axis.title.y=element_blank(),
          axis.text.x=element_text(size=12),
          #axis.text.y=element_blank(),
          #panel.grid.major.y = element_blank(), panel.grid.minor.y = element_blank(),
          axis.ticks.y = element_blank(),axis.ticks.margin = unit(0.2, "cm"))
  p
}

series=c(96.0, 15.0, 37.0, 283.0, 659.0, 288.0, 38.0, 157.0, 174.0, 19.0, 176.0, 5.0, 39.0, 217.0, 128.0, 4.0, 45.0, 104.0, 127.0, 34.0, 1227.0, 128.0, 0.0, 0.0, 16.0, 49.0, 34.0, 196.0, 29.0, 0.0, 0.0, 584.0, 15.0, 182.0, 24.0, 1104.0, 132.0, 1.0, 437.0, 69.0, 165.0, 157.0, 1.0, 4.0, 69.0, 481.0, 35.0, 385.0, 34.0, 8.0, 0.0, 4.0, 111.0, 325.0, 328.0, 170.0, 194.0, 78.0, 0.0, 65.0, 6.0, 27.0, 69.0, 0.0, 74.0, 49.0, 71.0, 82.0, 122.0, 27.0, 8.0, 0.0, 33.0, 0.0, 6.0, 39.0, 0.0, 10.0, 77.0, 76.0, 335.0, 242.0, 263.0, 406.0, 108.0, 50.0, 950.0, 1097.0, 547.0, 17.0, 462.0, 29.0, 359.0, 134.0, 140.0, 168.0, 111.0, 43076.0, 21.0, 41.0, 9.0, 359.0, 92.0, 63.0, 95.0, 2.0, 3.0, 281.0, 1.0, 164.0, 3.0, 136.0, 89.0, 14.0, 220.0, 1311.0, 131.0, 0.0, 20.0, 69.0, 73.0, 115.0, 20.0, 205.0, 97.0, 124.0, 4.0, 222.0, 49.0, 40.0, 147.0, 99.0, 27186.0, 91.0, 238.0, 0.0, 89.0, 12.0, 149.0, 39.0, 0.0, 0.0, 52.0, 0.0, 59.0, 87.0, 2.0, 5.0, 0.0, 8.0, 47.0, 50.0, 33.0, 121.0, 32.0, 108.0, 46.0, 30.0, 40.0, 16144.0, 12036.0, 380.0, 28.0, 4.0, 0.0, 0.0, 482.0, 73.0, 15.0, 31.0, 5.0, 183.0, 56.0, 10.0, 84.0, 31082.0, 18.0, 0.0, 0.0, 2.0, 26.0, 6113.0, 14.0)
weight=c(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.15113781655796346, 0.15113781655796346, 0.15113781655796346, 0.3022756331159269, 0.3022756331159269, 0.3022756331159269, 0.3022756331159269, 0.3022756331159269, 0.3022756331159269, 0.3022756331159269, 0.3022756331159269, 0.3022756331159269, 0.3022756331159269, 0.35265490530191473, 0.2015170887439513, 0.2015170887439513, 0.3526549053019148, 0.2518963609299391, 0.3526549053019148, 0.3526549053019148, 0.3526549053019148, 0.3526549053019148, 0.3526549053019148, 0.5037927218598782, 0.5037927218598782, 0.5037927218598782, 0.6045512662318538, 0.7556890827898174, 0.7556890827898174, 0.7556890827898174, 0.6549305384178418, 0.6045512662318538, 0.5037927218598782, 0.5037927218598782, 0.6549305384178417, 0.6549305384178417, 0.7053098106038295, 0.554171994045866, 0.554171994045866, 0.6045512662318538, 0.5037927218598782, 0.302275633115927, 0.4030341774879026, 0.4030341774879026, 0.3526549053019148, 0.3526549053019148, 0.3526549053019148, 0.3526549053019148, 0.2015170887439513, 0.2015170887439513, 0.1511378165579635, 0.1511378165579635, 0.2015170887439513, 0.2015170887439513, 0.2015170887439513, 0.2015170887439513, 0.10075854437197565, 0.2518963609299391, 0.2518963609299391, 0.2518963609299391, 0.2518963609299391, 0.2518963609299391, 0.2518963609299391, 0.2518963609299391, 0.2518963609299391, 0.2518963609299391, 0.2015170887439513, 0.15113781655796346, 0.15113781655796346, 0.15113781655796346, 0.2015170887439513, 0.050379272185987825, 0.050379272185987825, 0.2015170887439513, 0.2015170887439513, 0.2015170887439513, 0.2015170887439513, 0.2015170887439513, 0.2015170887439513, 0.2015170887439513, 0.2015170887439513, 0.2015170887439513, 0.2015170887439513, 0.2015170887439513, 0.15113781655796346, 0.15113781655796346, 0.15113781655796346, 0.0, 0.0, 0.0, 0.0, 0.10075854437197565, 0.10075854437197565, 0.10075854437197565, 0.10075854437197565, 0.10075854437197565, 0.10075854437197565, 0.10075854437197565, 0.10075854437197565, 0.10075854437197565, 0.10075854437197565, 0.10075854437197565, 0.10075854437197565, 0.10075854437197565, 0.10075854437197565, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.0, 0.0, 0.0, 0.10075854437197565, 0.2015170887439513, 0.2015170887439513, 0.25189636092993917, 0.25189636092993917, 0.3526549053019148, 0.3526549053019148, 0.3526549053019148, 0.4030341774879026, 0.4030341774879026, 0.4534134496738904, 0.4534134496738904, 0.4534134496738904, 0.4534134496738904, 0.5037927218598782, 0.4030341774879026, 0.4030341774879026, 0.3526549053019148, 0.7556890827898173, 0.7556890827898173, 0.7556890827898173, 1.15872326027772, 1.209102532463708, 1.3602403490216715, 1.4106196212076594, 1.4106196212076594, 1.4106196212076594, 1.4106196212076594, 1.2594818046496958, 1.2594818046496958, 1.2594818046496958, 1.2594818046496958, 0.856447627161793, 0.7556890827898173, 0.7556890827898173, 0.3526549053019148, 0.2518963609299391, 0.10075854437197565, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)
c1 <- plot_series(c(1:length(series)), series, weight, "Non-CF")
c1

series=c(309.0, 605.0, 13307.0, 72.0, 0.0, 71.0, 149.0, 82.0, 78.0, 6731.0, 125.0, 190.0, 57.0, 30.0, 110.0, 2.0, 21.0, 66.0, 10.0, 92.0, 202.0, 10.0, 110.0, 40.0, 183.0, 4.0, 8.0, 3.0, 99.0, 98.0, 92.0, 2636.0, 542.0, 67.0, 1316.0, 46.0, 70.0, 1.0, 0.0, 158.0, 16.0, 173.0, 430.0, 169.0, 56.0, 1145.0, 0.0, 201.0, 28.0, 85.0, 20.0, 293.0, 0.0, 0.0, 87.0, 25.0, 28.0, 72.0, 79.0, 0.0, 76.0, 77.0, 183.0, 201.0, 45.0, 42.0, 38.0, 0.0, 40.0, 24.0, 917.0, 1656.0, 56.0, 14.0, 101.0, 19.0, 0.0, 25.0, 5.0, 4.0, 41.0, 28.0, 2.0, 69.0, 129.0, 17692.0, 49.0, 72.0, 7.0, 15.0, 11.0, 111.0, 124.0, 9.0, 0.0, 1.0, 18.0, 489.0, 612.0, 43.0, 400.0, 36.0, 196.0, 36.0, 19.0, 3.0, 5344.0, 42.0, 10.0, 0.0, 57.0, 1.0, 69.0, 157.0, 25.0, 42.0, 12.0, 98.0, 195.0, 54.0, 55.0, 21.0, 0.0, 0.0, 17.0, 63.0, 28.0, 73.0, 32.0, 0.0, 22.0, 59.0, 156.0, 9.0, 5.0)
weight=c(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.2015170887439513, 0.2015170887439513, 0.2015170887439513, 0.3526549053019148, 0.3526549053019148, 0.3526549053019148, 0.3526549053019148, 0.3526549053019148, 0.3526549053019148, 0.3526549053019148, 0.4030341774879026, 0.4030341774879026, 0.4030341774879026, 0.4030341774879026, 0.2015170887439513, 0.2015170887439513, 0.3022756331159269, 0.2015170887439513, 0.2015170887439513, 0.2015170887439513, 0.302275633115927, 0.302275633115927, 0.3526549053019148, 0.3526549053019148, 0.302275633115927, 0.302275633115927, 0.302275633115927, 0.302275633115927, 0.302275633115927, 0.302275633115927, 0.2015170887439513, 0.1511378165579635, 0.1511378165579635, 0.1511378165579635, 0.050379272185987825, 0.050379272185987825, 0.0, 0.0, 0.0, 0.0, 0.10075854437197565, 0.10075854437197565, 0.2015170887439513, 0.2015170887439513, 0.2015170887439513, 0.3526549053019148, 0.5037927218598782, 0.5037927218598782, 0.5037927218598782, 0.5037927218598782, 0.5037927218598782, 0.5037927218598782, 0.5037927218598782, 0.5037927218598782, 0.4030341774879026, 0.4030341774879026, 0.3022756331159269, 0.3022756331159269, 0.3022756331159269, 0.15113781655796346, 0.0, 0.0, 0.15113781655796346, 0.2518963609299391, 0.2518963609299391, 0.2518963609299391, 0.2518963609299391, 0.2518963609299391, 0.2518963609299391, 0.2518963609299391, 0.2518963609299391, 0.2518963609299391, 0.6549305384178417, 0.6549305384178417, 0.6549305384178417, 1.0579647159057444, 0.9068268993477808, 0.8060683549758052, 0.8060683549758052, 0.8060683549758052, 0.8060683549758052, 0.856447627161793, 0.856447627161793, 0.856447627161793, 0.856447627161793, 0.856447627161793, 0.4534134496738904, 0.4534134496738904, 0.4534134496738904, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.0, 0.0, 0.10075854437197565, 0.10075854437197565, 0.1511378165579635, 0.1511378165579635, 0.2015170887439513, 0.2015170887439513, 0.2518963609299391, 0.3022756331159269, 0.35265490530191473, 0.40303417748790255, 0.40303417748790255, 0.40303417748790255, 0.40303417748790255, 0.40303417748790255, 0.3022756331159269, 0.35265490530191473, 0.3022756331159269, 0.3022756331159269, 0.2518963609299391, 0.2518963609299391, 0.2015170887439513, 0.1511378165579635, 0.10075854437197565, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.0, 0.0)
c2 <- plot_series(c(1:length(series)), series, weight, "Non-CF")
c2

series=c(93.0, 4.0, 29.0, 176.0, 117.0, 63.0, 3.0, 63.0, 8.0, 3.0, 8.0, 4.0, 17.0, 31.0, 94.0, 108.0, 3.0, 233.0, 229.0, 161.0, 134.0, 265.0, 0.0, 0.0, 12.0, 22.0, 396.0, 36046.0, 3109.0, 183.0, 33.0, 33.0, 8.0, 180.0, 226.0, 231.0, 297.0, 34.0, 20.0, 78.0, 59.0, 30.0, 224.0, 30.0, 274.0, 21.0, 202.0, 29.0, 67.0)
weight=c(0.0, 0.0, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.050379272185987825, 0.10075854437197565, 0.10075854437197565, 0.1511378165579635, 0.2015170887439513, 0.2015170887439513, 0.2015170887439513, 0.2015170887439513, 0.2015170887439513, 0.1511378165579635, 0.1511378165579635, 0.1511378165579635, 0.1511378165579635, 0.1511378165579635, 0.554171994045866, 0.5037927218598782, 0.5037927218598782, 0.856447627161793, 0.8060683549758052, 0.8060683549758052, 0.9068268993477808, 0.9068268993477808, 0.9068268993477808, 0.9572061715337686, 1.0579647159057444, 1.0579647159057444, 1.0579647159057444, 1.0579647159057444, 0.6549305384178417, 0.6549305384178417, 0.6549305384178417, 0.25189636092993917, 0.25189636092993917, 0.25189636092993917, 0.1511378165579635, 0.1511378165579635, 0.1511378165579635, 0.10075854437197565, 0.0, 0.0, 0.0, 0.0)
c3 <- plot_series(c(1:length(series)), series, weight, "Non-CF")
c3
#
series=c(38.0, 32.0, 91.0, 48.0, 75.0, 163.0, 209.0, 3.0, 10.0, 3538.0, 1556.0, 44.0, 132.0, 129.0, 1.0, 169.0, 0.0, 0.0, 401.0, 764.0, 41.0, 19.0, 54.0, 29.0, 80.0, 67.0, 55.0, 49.0, 16.0, 293.0, 19.0, 119.0, 118.0, 2.0, 17.0, 25.0)
weight=c(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.18983159915049974, 0.18983159915049974, 0.2847473987257496, 0.2847473987257496, 0.2847473987257496, 0.6644105970267491, 0.6644105970267491, 0.6644105970267491, 0.6644105970267491, 0.759326396601999, 0.759326396601999, 0.759326396601999, 0.759326396601999, 0.759326396601999, 0.5694947974514992, 0.759326396601999, 0.6644105970267491, 0.6644105970267491, 0.6644105970267491, 0.2847473987257496, 0.2847473987257496, 0.2847473987257496, 0.2847473987257496, 0.18983159915049974, 0.18983159915049974, 0.18983159915049974, 0.18983159915049974, 0.18983159915049974, 0.18983159915049974)
p1 <- plot_series(c(1:length(series)), series, weight, "Commit Fest")
p1

series=c(67.0, 98.0, 69.0, 37.0, 222.0, 10.0, 11.0, 3.0, 0.0, 1767.0, 15.0, 0.0, 0.0, 4.0, 35.0, 12.0, 18.0, 23.0, 31.0, 100.0, 237.0, 705.0, 8.0, 165.0, 21.0, 173.0, 0.0, 171.0, 34.0, 369.0, 218.0, 16.0, 106.0)
weight=c(0.0, 0.0, 0.0, 0.3796631983009995, 0.3796631983009995, 0.3796631983009995, 0.3796631983009995, 0.3796631983009995, 0.3796631983009995, 0.3796631983009995, 0.3796631983009995, 0.3796631983009995, 0.3796631983009995, 0.3796631983009995, 0.3796631983009995, 0.3796631983009995, 0.3796631983009995, 0.0, 0.0, 0.09491579957524987, 0.09491579957524987, 0.09491579957524987, 0.09491579957524987, 0.09491579957524987, 0.09491579957524987, 0.09491579957524987, 0.09491579957524987, 0.09491579957524987, 0.09491579957524987, 0.09491579957524987, 0.09491579957524987, 0.09491579957524987, 0.09491579957524987)
p2 <- plot_series(c(1:length(series)), series, weight, "Commit Fest")
p2

series=c(819.0, 59.0, 21.0, 92.0, 244.0, 6.0, 2286.0, 113.0, 161.0, 164.0, 1.0, 35.0, 227.0, 23.0, 53.0, 139.0, 67.0, 1485.0, 26.0, 38.0, 101.0, 71.0, 152.0, 21.0, 312.0, 62.0, 66.0, 30.0, 38.0, 2.0, 20.0, 67.0, 286.0)
weight=c(0.3796631983009995, 0.3796631983009995, 0.3796631983009995, 0.3796631983009995, 0.3796631983009995, 0.3796631983009995, 0.47457899787624935, 0.47457899787624935, 0.47457899787624935, 0.6644105970267491, 0.6644105970267491, 0.6644105970267491, 0.759326396601999, 0.759326396601999, 0.3796631983009995, 0.47457899787624935, 0.47457899787624935, 0.47457899787624935, 0.47457899787624935, 0.759326396601999, 0.6644105970267491, 0.6644105970267491, 0.6644105970267491, 0.47457899787624935, 0.47457899787624935, 0.47457899787624935, 0.3796631983009995, 0.3796631983009995, 0.3796631983009995, 0.2847473987257496, 0.2847473987257496, 0.2847473987257496, 0.2847473987257496)
p3 <- plot_series(c(1:length(series)), series, weight, "Commit Fest")
p3
#
require(gridExtra)
grid.arrange(c1, c2, c3,
             p1, p2, p3, ncol=3)

Cairo(width = 1300, height = 600, 
      file="figures/postgre_cf_patterns", 
      type="ps", pointsize=9, 
      bg = "transparent", canvas = "white", units = "px", dpi = 82)
print(grid.arrange(c1, c3, c2,p1, p2, p3, ncol=3))
dev.off()
