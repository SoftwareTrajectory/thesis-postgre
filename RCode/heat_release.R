require(ggplot2)
require(Cairo)
require(reshape)
require(scales)
require(RColorBrewer)
require(grid)
library(gridExtra)
#
znorm <- function(ts){
  ts.mean <- mean(ts)
  ts.dev <- sd(ts)
  (ts - ts.mean)/ts.dev
}
#
#
#pattern="iihecccccccc"; weight=0.1063
#0: [97, 98], [-0.6478854, -0.64199155, -0.63818632, -0.63825875, -0.63834515, -0.63869741, -0.64304876, -0.64376789, -0.64504991, -0.64711823, -0.64915334, -0.65124584, -0.65729046, -0.66220082, -0.66123227, -0.66098661, -0.66156196, -0.66225552, -0.66191228, -0.66274039, -0.66093438, -0.66344985, -0.66219448, -0.6623359, -0.66171176, -0.66139185, -0.66140829, -0.66144719, -0.66037322, -0.65910828, -0.65974177, -0.65817648, -0.65839527, -0.65734763, -0.65851971, -0.6584864, -0.657366, -0.65435815, -0.65251819, -0.6513159, -0.64814481, -0.64733294, -0.64709792, -0.64486153, -0.64360412, -0.64349171, -0.64265061, -0.6420974, -0.64447929, -0.6488921, -0.65765851, -0.66120325, -0.64966432, -0.61016844, -0.53743483, -0.46503123, -0.35853483, -0.28313648, -0.17744604, 0.15824648, 0.35028455, 0.48241039, 0.60380734, 0.79710411, 0.98755132, 1.2037853, 1.4065415, 1.5962459, 1.7128307, 1.7788152, 1.7938492, 1.7971408, 1.8101928, 1.8206277, 1.8172235, 1.8316333, 1.8316333, 1.828965, 1.8453761, 1.8452577, 1.8458113, 1.8424932, 1.8353569, 1.8363734, 1.8406975, 1.8325128, 1.8317604, 1.8292355, 1.82239, 1.8137368, 1.8065749, 1.7817465, 1.7681708, 1.714996, 1.6361695, 1.5421009, 1.4168285, 1.295362, 1.1717134, 1.0294766, 0.83269526, 0.74873661, 0.48444394, 0.46799664, 0.13619262, -0.02096398, -0.24144559, -0.42927857, -0.54787937, -0.65770118, -0.74082076, -0.77535158, -0.78246083, -0.7692917, -0.74327798, -0.71938126, -0.69687714, -0.6863145, -0.67373867, -0.6683903, -0.66464289, -0.66411665, -0.66429579, -0.66119756, -0.65934631, -0.65258234, -0.64332472, -0.63886892, -0.63655838, -0.63317355, -0.63303697, -0.63300935, -0.63303406, -0.63521866, -0.63446965, -0.63579121, -0.63628253, -0.63539522, -0.63607448, -0.63755154, -0.63926427, -0.63971561, -0.63973452, -0.64018371, -0.6392345, -0.63939473, -0.64023111, -0.64042873, -0.63866571, -0.63865722]
#[2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 2.0360672131928594, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]

plot_series=function(x,y,weight,title){
  dat=data.frame(x=x,y=as.vector(unlist(y)),col=rescale(weight))
  p <- ggplot(dat, aes(x,y,colour=col)) + geom_line(size=1.2) +
    ggtitle(title) + theme_bw() +
    #scale_y_continuous(expand=c(0.01,0.01),breaks=seq(-1,1,1),labels=paste(seq(-1,1,1))) + 
    scale_colour_gradientn(name = "Class specificity:  ",limits=c(0,1),
                           colours=c("darkgreen","chartreuse4","darkgoldenrod1","brown3","darkred"),
                           breaks=c(0,0.5,1),labels=c("low","neutral","high"), 
                           guide = guide_colorbar(title.theme=element_text(size=14, angle=0),title.vjust=1,
                                                  barheight=0.6, barwidth=6, label.theme=element_text(size=10, angle=0))) +
    theme(legend.position="bottom",plot.title=element_text(size=24),
          axis.title.x=element_blank(), axis.title.y=element_blank(),
          axis.text.x=element_text(size=12),axis.text.y=element_blank(),
          panel.grid.major.y = element_blank(), panel.grid.minor.y = element_blank(),
          axis.ticks.y = element_blank(),axis.ticks.margin = unit(0.2, "cm"))
  p
}

series=c(5.0, 1405.0, 696.0, 3.0, 409.0, 0.0, 1165.0, 19642.0, 119.0, 1.0, 19.0, 14.0, 41.0, 56.0, 49.0, 48.0, 2022.0, 57.0, 32.0, 5.0, 4.0, 0.0, 553.0, 140.0, 6.0, 42.0, 2.0, 0.0, 0.0)
weight=c(0.230089496654211, 0.30678599553894803, 0.38348249442368504, 0.46017899330842205, 0.46017899330842205, 0.76696498884737, 0.76696498884737, 0.8436614877321069, 0.8436614877321069, 0.8436614877321069, 0.8436614877321069, 1.073750984386318, 1.073750984386318, 1.303840481040529, 1.073750984386318, 1.073750984386318, 0.997054485501581, 0.9203579866168441, 0.9203579866168441, 0.6135719910778961, 0.6135719910778961, 0.536875492193159, 0.536875492193159, 0.536875492193159, 0.536875492193159, 0.30678599553894803, 0.30678599553894803, 0.07669649888473701, 0.07669649888473701)
c1 <- plot_series(c(1:length(series)), series, weight, "Pre-release")
c1

series=c(2.0, 134.0, 10.0, 81.0, 128.0, 718.0, 37.0, 41.0, 23.0, 675.0, 83.0, 1780.0, 343.0, 238.0, 660.0, 7.0, 28.0, 42.0, 1037.0, 15.0, 699.0, 47.0, 384.0, 6.0, 449.0, 92.0, 544.0, 232.0, 324.0)
weight=c(0.15339299776947402, 0.23008949665421102, 0.23008949665421102, 0.38348249442368504, 0.46017899330842205, 0.46017899330842205, 0.5368754921931591, 0.5368754921931591, 0.7669649888473701, 0.843661487732107, 0.843661487732107, 0.9203579866168441, 0.997054485501581, 1.073750984386318, 0.920357986616844, 0.920357986616844, 0.920357986616844, 0.7669649888473701, 0.690268489962633, 0.690268489962633, 0.6135719910778961, 0.6135719910778961, 0.38348249442368504, 0.30678599553894803, 0.30678599553894803, 0.23008949665421102, 0.15339299776947402, 0.07669649888473701, 0.07669649888473701)
c2 <- plot_series(c(1:length(series)), series, weight, "Pre-release")
c2

series=c(544.0, 73.0, 251.0, 0.0, 2337.0, 244.0, 82.0, 7.0, 29.0, 395.0, 234.0, 502.0, 40.0, 85.0, 58.0, 506.0, 41.0, 46.0, 27.0, 43.0, 187.0, 2834.0, 288.0, 623.0, 1937.0, 10477.0, 11.0, 895.0, 519.0)
weight=c(0.0, 0.230089496654211, 0.230089496654211, 0.230089496654211, 0.30678599553894803, 0.38348249442368504, 0.38348249442368504, 0.38348249442368504, 0.38348249442368504, 0.38348249442368504, 0.38348249442368504, 0.46017899330842205, 0.46017899330842205, 0.536875492193159, 0.536875492193159, 0.46017899330842205, 0.46017899330842205, 0.46017899330842205, 0.38348249442368504, 0.30678599553894803, 0.30678599553894803, 0.30678599553894803, 0.30678599553894803, 0.30678599553894803, 0.30678599553894803, 0.23008949665421102, 0.23008949665421102, 0.15339299776947402, 0.15339299776947402)
c3 <- plot_series(c(1:length(series)), series, weight, "Pre-release")
c3
#
series=c(0.0, 23.0, 2.0, 2061.0, 541.0, 52.0, 7.0, 190.0, 356.0, 35.0, 24.0, 131.0, 42.0, 109.0, 5.0, 152.0, 0.0, 316.0, 572.0, 12.0, 109.0, 45.0, 1146.0, 253.0, 165.0, 159.0, 3.0, 503.0, 0.0)
weight=c(0.0, 0.07602859212697051, 0.22808577638091154, 0.22808577638091154, 0.22808577638091154, 0.22808577638091154, 0.22808577638091154, 0.30411436850788204, 0.38014296063485253, 0.5322001448887935, 0.5322001448887935, 0.8363145133966757, 1.1404288819045576, 1.2164574740315282, 1.2924860661584987, 1.4445432504124398, 1.2924860661584987, 1.2924860661584987, 1.2924860661584987, 1.2924860661584987, 1.2924860661584987, 1.2164574740315282, 1.1404288819045576, 0.9883716976506167, 0.9883716976506167, 0.6842573291427346, 0.38014296063485253, 0.30411436850788204, 0.22808577638091151)
p1 <- plot_series(c(1:length(series)), series, weight, "Post-release")
p1

series=c(155.0, 16.0, 3.0, 0.0, 3.0, 0.0, 25.0, 158.0, 64.0, 0.0, 103.0, 84.0, 8.0, 40.0, 163.0, 19.0, 29.0, 149.0, 296.0, 13.0, 71.0, 116.0, 325.0, 753.0, 55.0, 338.0, 121.0, 229.0, 648.0)
weight=c(0.0, 0.07602859212697051, 0.15205718425394102, 0.15205718425394102, 0.22808577638091154, 0.5322001448887935, 0.5322001448887935, 0.5322001448887935, 0.8363145133966757, 0.9883716976506167, 0.9883716976506167, 0.9883716976506167, 1.0644002897775873, 1.1404288819045578, 1.1404288819045578, 1.1404288819045578, 1.0644002897775873, 1.0644002897775873, 0.9883716976506167, 0.6842573291427347, 0.6842573291427347, 0.6842573291427347, 0.38014296063485253, 0.22808577638091154, 0.22808577638091154, 0.22808577638091154, 0.15205718425394102, 0.07602859212697051, 0.07602859212697051)
p2 <- plot_series(c(1:length(series)), series, weight, "Post-release")
p2

series=c(0.0, 182.0, 232.0, 74.0, 40.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 84.0, 5.0, 0.0, 595.0, 0.0, 2.0, 0.0, 0.0, 4.0, 8.0, 0.0, 645.0, 526.0, 0.0, 0.0, 0.0, 0.0, 0.0)
weight=c(0.07602859212697051, 0.07602859212697051, 0.07602859212697051, 0.07602859212697051, 0.07602859212697051, 0.22808577638091154, 0.22808577638091154, 0.22808577638091154, 0.45617155276182303, 0.45617155276182303, 0.45617155276182303, 0.45617155276182303, 0.45617155276182303, 0.45617155276182303, 0.38014296063485253, 0.38014296063485253, 0.38014296063485253, 0.38014296063485253, 0.38014296063485253, 0.22808577638091151, 0.22808577638091151, 0.22808577638091151, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)
p3 <- plot_series(c(1:length(series)), series, weight, "Post-release")
p3
#
require(gridExtra)
grid.arrange(c1, c2, c3,
             p1, p2, p3, ncol=3)

Cairo(width = 900, height = 400, 
      file="figures/postgre_release_patterns", 
      type="ps", pointsize=9, 
      bg = "transparent", canvas = "white", units = "px", dpi = 82)
print(grid.arrange(c1, c2, c3,p1, p2, p3, ncol=3))
dev.off()
